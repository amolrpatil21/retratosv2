# ReTraTos v2 - GSoC 2024
## [Link to Proposal](https://wiki.apertium.org/wiki/User:Daedalus/GSoC2024Proposal)

# Setting up
A few prereqiusites need to be installed before you can get started.
<ol>
<li> eflomal
<li> python dependencies
</ol>

<b> how to setup eflomal: </b>
Follow the install instructions given [here](https://github.com/robertostling/eflomal) - we only need the C binary
here are the instructions just in case
<ol>
<li> clone the eflomal repostiry from the link above
<li> cd in to the repository
<li> Install the C binary using the following commands
</ol>

````
   $ make -C src
   $ sudo make -C src install
````
refer to the extended install instructions at the above link for furter details


<b>python dependencies</b><br>
it can be a good idea to make a virtual environment first using the following steps
````
   $ python -m venv .venv
   $ source .venv/bin/activate
````
Next, install the requirements using
````
   $ pip install -r requirements.txt
````


# Usage
+ retratos.py is the main script that can perform different functions by changing the mode parameter
+ a mode has to be selected out of generate_priors, align, filter and suggest(generate bidix patches) using the argument --mode
+ specify a working directory using ````--workdir````. The working directory will contain all your generated files such as priors, links and other files generated by eflomal, filtered priors and finally the bidix patches. 
<br><br>
<h3>NOTE:</h3>
<b> Provide an absolute path for the workdir, otherwise, it will get created in the same folder as retratos itself.</b>
<br>
<b> All other paths should be specified relative to the workdir </b>


## Workflow
ReTraTos was created to develop bidix patches from parallel corpora. It has different modes so that the output can be inspected at each step of the patch creation process.
To create bidix patches from parallel corpora, the following steps can be followed
<ol>
<li> Create priors from the parallel corpora using the generate priors mode
<li> Filter the generated priors using the filter mode
<li> Generate bidix patches using the suggest mode
</ol>


## Generating Priors

Given a set of large parallel corpora, eflomal can be used to generate priors. These priors are generated on tagged forms of the sentences and can then be used for selectively patching the bidix.

- use   ````--mode generate_priors````

example usage <br>
````
python retratos.py --mode generate_priors --workdir "./" --left "./example_data/eng-small.txt" --right "./example_data/spa-small.txt" --lang_dir "/home/user/apertium-eng-spa" --output "latest.priors" --left_lang "eng" --right_lang "spa" --left_config "config.eng.json" --right_config "config.spa.json"
````

## Filtering the Priors
filter the generated priors to keep only the best candidates for patching into the bidix.

- use   ````--mode filter````


example usage <br>
````
python retratos.py --mode filter --workdir "./" --include_unknowns True --min_freq 1 --keep_top 100 --output filtered.priors
````

## Generating Bidix Patches
Generate bidix patches in the apertium bidix format from the filtered priors. If a file is not specified, it shall automatically use the default priors file from the workdir. The output file generated will be called bidix.patches unless another name is provided using the --output parameter

- use   ````--mode suggest````

<br>
<i>
optional parameters: 
<ul>
<li> --output(to specify custom output filename), 
<li> --file (to specify a custom filtered priors file)
</ul>
</i><br>

the mode will fail if a custom file is not provided using the ````--file```` parameter and the default filtered priors file called ````filtered.priors```` does not exist.

example usage <br>
````
python retratos.py --mode suggest --workdir "./" --output bidix_new.patches
````


### workspace defaults
- priors file saved as latest.priors
- file to be aligned is alignment_file.txt by default

### config file
- config is saved to config.json
- can be directly edited or use config_creatory.py
- currently only keeping the first tag unless the config specifies which other tags to include


### Need Help ? 
for any further questions, you may reach out to the author at gschaitanya2003[at]gmail[dot]com or raise an issue in the repository
